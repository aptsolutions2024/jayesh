<?php //error_reporting(0);session_start();//header('Content-type: application/excel');//header('Content-Disposition: attachment; filename="employee_detail.xls"');include("../lib/connection/db-config.php");include("../lib/class/user-class.php");include("../lib/class/bonus.php");$setCounter = 0;$userObj=new user();$bonus=new bonus();$setCounter = 0;$month=$_SESSION['month'];$comp_id=$_SESSION['comp_id'];$user_id=$_SESSION['log_id'];$clintid=$_SESSION['clintid'];$startbon = explode('-',$_SESSION['startbonusyear']); $startbon = $startbon[2]."-".$startbon[1]."-".$startbon[0];$endbon = explode('-',$_SESSION['endbonusyear']); $endbon = $endbon[2]."-".$endbon[1]."-".$endbon[0];$setExcelName = "employee_detail";$emp=$_REQUEST['emp'];$res=$userObj->showEmployeereport($comp_id,$user_id);$resclt=$userObj->displayClient($clintid);$cmonth=$resclt['current_month'];if($month=='current'){	$monthtit =  date('F Y',strtotime($cmonth));     $frdt=$cmonth;    $todt=$cmonth;    $tab_emp='bonus';    $esifrdt=$cmonth;	     }else{    $monthtit =  date('F Y',strtotime($_SESSION['frdt']));	$frdt=date("Y-m-d", strtotime($_SESSION['frdt']));    $todt=date("Y-m-d", strtotime($_SESSION['frdt']));    $tab_emp='bonus';     }  //te = tab_emp, e = employee,mc = mast_company,t3= mast_client,mb = mast_bank  $desc = "Bonus FOR THE MONTH ".$monthtit; if($emp=='Parent')	{ 				$setRec = $bonus->getBonusNeftExpParantDataColumn($clintid,$desc,$startbon,$endbon);		$setRecr = $bonus->getBonusNeftExpParantData($clintid,$desc,$startbon,$endbon);		 $num =$setRecr->rowCount();		 /*$setSql= "SELECT te.tot_bonus_amt,mc.bankacno as sender_bankacno,mb.ifsc_code,concat(".chr(34).chr(39).chr(34).",te.`bankacno`)as beneficiary_acno ,'10' as 'Account Type',concat(e.first_name,' ',e.middle_name,' ',e.last_name) AS 'Beneficiary Customer Name', e.pin_code as 'Beneficiary Customer Address','".$desc ."' as 'Sender to Receiver Information', mc.comp_name as 'Originator Of Remittance' FROM $tab_emp te inner join employee e on e.emp_id = te.emp_id inner join mast_company mc on te.comp_id = mc.comp_id inner join mast_client t3 on te.client_id= t3.mast_client_id inner join mast_bank mb on te.bank_id = mb.mast_bank_id where t3.parentid='".$clintid."' and e.pay_mode = 'N'"; */		 		}else{ 	$setRec = $bonus->getBonusNeftExpData($clintid,$desc,$startbon,$endbon,$comp_id,$user_id);$setRecr = $bonus->getBonusNeftExpDataRow($clintid,$desc,$startbon,$endbon,$comp_id,$user_id); $num =$setRecr->rowCount(); 	/* $setSql= "SELECT te.tot_bonus_amt,te.bankacno as bankacno,mc.comp_name,mb.ifsc_code,te.bankacno as beneficiary_acno ,'10' as type,concat(e.first_name,' ',e.middle_name,' ',e.last_name) AS name, e.emp_add1,'".$desc ."' as descri, mc.comp_name as Originator from $tab_emp te inner join employee e on te.emp_id = e.emp_id inner join mast_bank mb on mb.mast_bank_id = te.bank_id inner join mast_company mc on mc.comp_id = te.comp_id where te.comp_id ='".$comp_id."' AND te.user_id='".$user_id."' and te.from_date = '$startbon' and te.todate = '$endbon' and te.tot_bonus_amt > 0 and te.pay_mode = 'B' and e.client_id='".$clintid."' ORDER BY te.bank_id, bankacno,e.last_name,e.first_name,e.middle_name,e.Joindate ASC"; */	 	 }//echo  $setSql; $total_column = sizeof($setRec);//var_dump($total_column);//$key = key($setRec);$column1="";$coln="";if($num!=0){$coln =array_keys($setRec);//print_r(array_keys($setRec));foreach($coln  as $col){	$column1 .= $col."\t";}}/*for ($counter = 0; $counter < $total_column; $counter ++) {    $meta = $setRec->getColumnMeta($counter);    //$column[] = $meta['name'];	$column1 .= $meta['name']."\t";}*///print_r($column1); exit;   //$setRec = mysql_query($setSql);/*$setCounter = mysql_num_fields($setRec);$setMainHeader="";$setData="";for ($i = 0; $i < $setCounter; $i++) {    $setMainHeader .= mysql_field_name($setRec, $i)."\t";}*/$setData="";$setMainHeader=$column1;//print_r($setMainHeader); exit;//print($setRec); exit;/*foreach($setRec as $rec){//while($rec = mysql_fetch_row($setRec))  {    $rowLine = '';    foreach($rec as $value)       {        if(!isset($value) || $value == "")  {            $value = "\t";			        }   else  {//It escape all the special charactor, quotes from the data.            $value = strip_tags(str_replace('"', '""', $value));            $value = '"' . $value . '"' . "\t";        }        $rowLine .= $value;    }    $setData .= trim($rowLine)."\n";}*///$setData = str_replace("\r", "", $setData);//if ($setData == "") {//    $setData = "\nno matching records found\n";//}//This Header is used to make data download instead of display the dataheader("Content-type: application/octet-stream");header("Content-Disposition: attachment; filename=".$setExcelName.".xls");header("Pragma: no-cache");header("Expires: 0");//It will print all the Table row as Excel file row with selected column name as header.//echo ucwords($setMainHeader)."\n".$setData."\n";?><table  border='1'><?php if($num!=0){?>   <tr>    <?php 		foreach($coln as $col){ ?>        <th ><?php echo ucwords($col); ?></th>            	<?php } ?></tr><?php }    $ln=0;    $background_color_new1='#F5FFE6';	   foreach($setRecr as $rec){        ?>        <tr >            <?php foreach($coln as $col){ ?><td style=""> <?php echo $rec[$col]; ?></td><?php }?>                </tr>		    <?php    $ln++; } 	if($num ==0){?>		<tr  ><td colspan="4">No Record Found</td></tr>	<?php }    ?> </table>