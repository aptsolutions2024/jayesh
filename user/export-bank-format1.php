<?php //error_reporting(0);session_start();include("../lib/connection/db-config.php");include("../lib/class/user-class.php");$userObj=new user();$setCounter = 0;$month=$_SESSION['month'];$comp_id=$_SESSION['comp_id'];$user_id=$_SESSION['log_id'];$clintid=$_SESSION['clintid'];$setExcelName = "employee_detail";$emp=$_POST['emp'];$res=$userObj->showEmployeereport($comp_id,$user_id);$resclt=$userObj->displayClient($clintid);$cmonth=$resclt['current_month'];if($month=='current'){    $monthtit =  date('F Y',strtotime($cmonth));    $tab_days='tran_days';    $tab_emp='tran_employee';    $tab_empinc='tran_income';    $tab_empded='tran_deduct';    $frdt=$cmonth;    $todt=$cmonth; }else{    $monthtit =  date('F Y',strtotime($_SESSION['frdt']));    $tab_days='hist_days';    $tab_emp='hist_employee';    $tab_empinc='hist_income';    $tab_empded='hist_deduct';    $frdt=date("Y-m-d", strtotime($_SESSION['frdt']));    $todt=date("Y-m-d", strtotime($_SESSION['frdt']));		$sql = "SELECT LAST_DAY('".$frdt."') AS last_day";	$row= mysql_query($sql);	$res = mysql_fetch_assoc($row);	$frdt = $res['last_day'];	 }   if($emp=='Parent'){$file =  "c:/salary/BANK_". $monthtit.'_'.$resclt['client_name'].'(P)'. chr(46)."csv";}else{$file =  "c:/salary/BANK_". $monthtit.'_'.$resclt['client_name']. chr(46)."csv";}if (file_exists($file))	{        unlink($file);    }   if($emp=='Parent')  {$setSql= "SELECT te.netsalary*100 as netsalary,mc.comp_name,concat(".chr(34).chr(39).chr(34).",mc.bankacno) as employer_bankacno,concat(".chr(34).chr(39).chr(34).",te.`bankacno`)as beneficiary_acno ,concat(e.first_name,' ',e.last_name) AS NAME ,mb.branch,mb.ifsc_code,concat(".chr(34).chr(39).chr(34).",e.mobile_no)as mobileno,e.email FROM $tab_emp te inner join employee e on e.emp_id = te.emp_id inner join mast_company mc on te.comp_id = mc.comp_id inner JOIN mast_bank mb on te.bank_id = mb.mast_bank_id  inner join mast_client mcl on e.client_id =mcl.mast_client_id where mcl.parentid = '".$clintid."' and te.sal_month = '$frdt'   order by first_name,last_name  INTO OUTFILE '".$file."' FIELDS TERMINATED BY ','   ENCLOSED BY '".chr(34) ."'  LINES TERMINATED BY '".chr(13).chr(10)."' ";}else{   $setSql= "SELECT te.netsalary*100 as netsalary,mc.comp_name,mc.bankacno as employer_bankacno,concat(".chr(34).chr(39).chr(34).",te.`bankacno`)as beneficiary_acno ,concat(e.first_name,' ',e.last_name) AS NAME ,mb.branch,mb.ifsc_code,concat(".chr(34).chr(39).chr(34).",e.mobile_no)as mobileno,e.email FROM $tab_emp te inner join employee e on e.emp_id = te.emp_id inner join mast_company mc on te.comp_id = mc.comp_id inner JOIN mast_bank mb on te.bank_id = mb.mast_bank_id  inner join mast_client mcl on e.client_id =mcl.mast_client_id where mcl.mast_client_id = '".$clintid."' and te.sal_month = '$frdt'   INTO OUTFILE '".$file."' FIELDS TERMINATED BY ','   ENCLOSED BY '".chr(34) ."'  LINES TERMINATED BY '".chr(13).chr(10)."' ";}$setRec = mysql_query($setSql);echo  "Data transferred to ".$file." successfully.";exit;$setCounter = mysql_num_fields($setRec);$setMainHeader="";$setData="";for ($i = 0; $i < $setCounter; $i++) {    $setMainHeader .= mysql_field_name($setRec, $i)."\t";}while($rec = mysql_fetch_row($setRec))  {    $rowLine = '';    foreach($rec as $value)       {        if(!isset($value) || $value == "")  {            $value = "\t";        }   else  {//It escape all the special charactor, quotes from the data.            $value = strip_tags(str_replace('"', '""', $value));            $value = '"' . $value . '"' . "\t";        }        $rowLine .= $value;    }    $setData .= trim($rowLine)."\n";}$setData = str_replace("\r", "", $setData);if ($setData == "") {    $setData = "\nno matching records found\n";}//This Header is used to make data download instead of display the dataheader("Content-type: application/octet-stream");header("Content-Disposition: attachment; filename=".$setExcelName.".xls");header("Pragma: no-cache");header("Expires: 0");//It will print all the Table row as Excel file row with selected column name as header.echo ucwords($setMainHeader)."\n".$setData."\n";?>