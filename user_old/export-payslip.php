<?phperror_reporting(0);session_start();include("../lib/connection/db-config.php");$setCounter = 0;$comp_id=$_SESSION['comp_id'];$user_id=$_SESSION['log_id'];$setExcelName = "employee_income";$client_id=$_POST['cal'];include("../lib/class/user-class.php");$userObj=new user();$rowclient=$userObj->displayClient($client_id); $setSql1= "SELECT mast_income_heads_id,income_heads_name FROM `mast_income_heads` WHERE `comp_id`='".$comp_id."' AND `user_id`='".$user_id."' AND  mast_income_heads_id in(select DISTINCT head_id from tran_income ti inner JOIN employee e on e.emp_id=ti.emp_id where ti.sal_month='2017-10-31' AND e.client_id='".$client_id."' AND ti.amount!='0') ";//SELECT mast_income_heads_id,income_heads_name FROM `mast_income_heads` WHERE `comp_id`='2' AND `user_id`='3' AND mast_income_heads_id in(select DISTINCT head_id from tran_income ti inner JOIN employee e on e.emp_id=ti.emp_id where ti.sal_month='2017-10-31' AND e.client_id='11')// $setSql1= "SELECT mast_income_heads_id,income_heads_name FROM `mast_income_heads` WHERE `comp_id`='".$comp_id."' AND `user_id`='".$user_id."' ";$setRec1 = mysql_query($setSql1);$setCounter1 = mysql_num_fields($setRec1);$setMainHeader="Sal Month";$setData="";$k=0;$temp[]='';$setMainHeader .="\t";$setMainHeader .="client Name";$setMainHeader .="\t";$setMainHeader .="Employee Id";$setMainHeader .="\t";$setMainHeader .="Name";$setMainHeader .="\t";while($tRec1 = mysql_fetch_assoc($setRec1)) {    $setMainHeader .= $tRec1['income_heads_name'];    $setMainHeader.="\t";    $temp[$k]= $tRec1['mast_income_heads_id'];    $k++;}$setMainHeader .="Gross Salary";$setMainHeader .="\t";  $tocount=sizeof($temp); $setSql= "SELECT t.sal_month,t.emp_id,concat(e.first_name,' ',e.middle_name,' ',e.last_name) as name FROM tran_employee t inner join employee e on e.emp_id=t.emp_id WHERE e.`comp_id`='".$comp_id."' AND e.`user_id`='".$user_id."' ";if($_POST['cal']!='all' && $_POST['cal']!='0'){    $setSql .= " AND e.client_id='".$_POST['cal']."'";} $setSql .= " order by e.client_id,e.first_name,e.middle_name,e.last_name ";$setRec = mysql_query($setSql);while($recq = mysql_fetch_array($setRec)) {    $rowLine = '';    $value='';    $fvalue = '"' . $recq['sal_month'] . '"' . "\t";    $fvalue .= '"' . $rowclient['client_name'] . '"' . "\t";    $fvalue .= '"' . $recq['emp_id'] . '"' . "\t";    $fvalue .= '"' . $recq['name'] . '"' . "\t";    for($j = 0; $tocount > $j; $j++){      $setSql22 = "SELECT ti.amount,te.gross_salary FROM tran_income ti inner join tran_employee te on ti.sal_month=te.sal_month AND ti.emp_id=te.emp_id  WHERE ti.`head_id`= '" . $temp [$j] . "'  AND ti.emp_id='" . $recq ['emp_id'] . "' ";        $setRec22 = mysql_query($setSql22);        $setReccount = mysql_num_rows($setRec22);        if($setReccount>0) {            $tgross_salary=0;            while($rec22 = mysql_fetch_array($setRec22)) {                $value1 = strip_tags(str_replace('"', '""', $rec22['amount']));                $value = '"' . $value1 . '"' . "\t";                $tgross_salary = $rec22['gross_salary'];            }        }        else{            $value = "\t";        }        $rowLine .=  $value;        }    $setData .= trim($fvalue.$rowLine.$tgross_salary)."\n";    }$setData = str_replace("\r", "", $setData);if ($setData == "") {    $setData = "\nno matching records found\n";}//This Header is used to make data download instead of display the dataheader("Content-type: application/octet-stream");header("Content-Disposition: attachment; filename=".$setExcelName.".xls");header("Pragma: no-cache");header("Expires: 0");//It will print all the Table row as Excel file row with selected column name as header.echo ucwords($setMainHeader)."\n".$setData."\n";?>